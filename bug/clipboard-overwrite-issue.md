# Bug分析：粘贴板内容被覆盖问题

## 问题描述
用户在使用语音输入功能时，如果粘贴板中已经存在内容，会被输入的内容覆盖。这可能导致用户丢失粘贴板中的重要或敏感信息。

## 问题分析

### 当前实现
在 `TextInputService.cs` 的第 44-50 行，程序使用了粘贴板方式来输入文本：

```csharp
// 先尝试使用剪贴板方式（对中文支持更好）
System.Windows.Application.Current.Dispatcher.Invoke(() =>
{
    System.Windows.Clipboard.SetText(text);
});

// 模拟 Ctrl+V 粘贴
_inputSimulator.Keyboard.ModifiedKeyStroke(VirtualKeyCode.CONTROL, VirtualKeyCode.VK_V);
```

### 问题根源
1. 程序优先使用粘贴板方式输入文本（对中文支持更好）
2. 直接调用 `Clipboard.SetText()` 会覆盖原有内容
3. 没有备份和恢复原始粘贴板内容的机制

### 安全风险
- 用户粘贴板可能包含敏感信息（密码、个人信息等）
- 覆盖粘贴板内容可能导致用户数据丢失

## 修复方案

### 方案一：优先使用键盘模拟输入（推荐）
- 将 `_inputSimulator.Keyboard.TextEntry()` 作为首选方法
- 只在键盘输入失败时才使用粘贴板
- 优点：避免使用粘贴板，不会影响用户数据
- 缺点：可能对某些复杂字符或中文输入支持不够完善

### 方案二：备份和恢复粘贴板内容
- 在使用粘贴板前先备份原内容
- 输入完成后恢复原内容
- 优点：保留对中文的良好支持
- 缺点：增加复杂性，仍有风险（如进程中断）

### 方案三：使用 SendKeys 或其他输入方法
- 研究使用 Windows API 的 SendInput 或其他方法
- 可能需要处理不同输入法和字符编码
- 优点：更底层的控制
- 缺点：实现复杂度高

## 修复步骤

1. **调整输入方法优先级**
   - 修改 `TypeText` 方法，优先使用键盘模拟
   - 只在必要时使用粘贴板

2. **改进键盘输入支持**
   - 测试并改进对中文和特殊字符的支持
   - 可能需要处理输入法切换

3. **添加配置选项**
   - 允许用户选择输入方法
   - 提供"安全模式"选项（不使用粘贴板）

4. **测试验证**
   - 测试各种字符输入（英文、中文、符号）
   - 测试不同应用程序的兼容性
   - 确保不影响用户粘贴板数据

## 临时解决方案
在正式修复前，可以：
1. 在文档中提醒用户此限制
2. 建议用户在使用语音输入前保存重要的粘贴板内容