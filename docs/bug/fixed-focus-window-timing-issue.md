# Bug分析：焦点窗口记录时机问题

## 问题描述
用户反馈：按下快捷键时光标在谷歌浏览器，但系统记录并输入到了微信窗口。

## 详细分析

### 日志分析
从提供的日志可以看出：
1. 没有 "F3 按下" 的日志记录，只有 "F3 释放"
2. 系统将文字输入到了微信窗口（Chrome_WidgetWin_1, 标题: 微信）
3. 用户声称按键时焦点在谷歌浏览器

### 可能的原因

1. **按键事件丢失**：
   - F3 按下事件可能没有被正确捕获
   - 导致焦点窗口没有在按键时记录

2. **焦点切换时机问题**：
   - 可能在按下 F3 和记录焦点之间有延迟
   - 用户可能在这个极短时间内切换了窗口

3. **热键处理导致的焦点变化**：
   - 某些应用在检测到全局热键时可能会抢夺焦点
   - 微信等 IM 应用可能有特殊的热键响应机制

## 进一步的修复方案

### 方案一：确保按键事件被正确处理
1. 添加按键按下的日志确认
2. 在按键瞬间立即记录焦点，避免任何延迟

### 方案二：使用更精确的焦点获取方法
1. 获取鼠标位置下的窗口
2. 或使用 GetGUIThreadInfo 获取更准确的输入焦点

### 方案三：添加防抖动机制
1. 在按键前短暂时间内连续获取焦点窗口
2. 确保焦点稳定后再记录

## 建议的调试步骤

1. 运行带有新日志的版本，查看：
   - "GetCurrentFocusWindow" 的输出
   - "按键时记录焦点窗口" 的日志
   - 是否有 "F3 按下" 的记录

2. 测试不同场景：
   - 在浏览器中按键，不切换窗口
   - 在浏览器中按键，立即切换到微信
   - 在微信中按键

3. 检查是否有其他应用干扰：
   - 关闭微信后测试
   - 使用其他应用测试（如记事本）