# 需求文档 - 自定义Prompt处理功能

## 介绍

为 VoiceInput 输入法增加自定义 Prompt 处理功能，允许用户配置多个快捷键，每个快捷键对应不同的语音识别配置。通过自定义 Prompt 内容，实现指定的输入语言和输出语言转换，支持中英混合输入、多语言输出等场景。

## 需求

### 需求 1 - 多快捷键配置管理

**用户故事：** 作为用户，我希望能够配置多个快捷键，每个快捷键对应不同的语音识别设置，以便在不同场景下快速切换使用。

#### 验收标准

1. When 用户在设置界面添加新的快捷键配置时，系统 shall 创建一个新的配置项，包含快捷键、输入语言、输出语言和自定义 Prompt。
2. When 用户选择删除某个快捷键配置时，系统 shall 从配置列表中移除该项并取消注册对应的全局快捷键。
3. When 用户修改快捷键配置时，系统 shall 验证快捷键是否与现有配置冲突，并在冲突时显示错误提示。
4. While 系统运行时，when 检测到配置的快捷键冲突，系统 shall 禁用冲突的快捷键并在界面上标记警告。

### 需求 2 - 自定义 Prompt 编辑

**用户故事：** 作为用户，我希望能够编辑每个快捷键对应的系统提示词（Prompt），以精确控制语音识别的行为。

#### 验收标准

1. When 用户选择编辑某个配置的 Prompt 时，系统 shall 显示一个文本编辑器，支持多行输入。
2. When 用户保存 Prompt 修改时，系统 shall 验证 Prompt 内容的有效性（非空、长度限制）。
3. While 编辑 Prompt 时，系统 shall 提供预设的 Prompt 模板供用户参考和使用。
4. When 用户选择重置 Prompt 时，系统 shall 恢复该配置的默认 Prompt 内容。

### 需求 3 - 语言配置

**用户故事：** 作为用户，我希望能够为每个快捷键配置输入语言和输出语言，实现跨语言的语音输入。

#### 验收标准

1. When 用户配置快捷键时，系统 shall 提供输入语言和输出语言的下拉选择，支持中文、英文、日文等常用语言。
2. When 用户选择"中英混合"作为输入语言时，系统 shall 在 Prompt 中体现对混合语言的支持。
3. While 使用配置的快捷键录音时，系统 shall 根据配置的输入语言调用相应的 Whisper API 参数。
4. When 语音识别完成后，系统 shall 根据输出语言配置和 Prompt 内容，返回指定语言的文本。

### 需求 4 - 快捷键使用体验

**用户故事：** 作为用户，我希望能够通过不同的快捷键触发不同的语音识别配置，快速完成特定场景的输入。

#### 验收标准

1. When 用户按下配置的快捷键时，系统 shall 立即开始录音，并使用该快捷键对应的配置。
2. While 录音进行中，系统 shall 在托盘图标或状态栏显示当前使用的配置名称。
3. When 语音识别完成时，系统 shall 根据配置的 Prompt 处理识别结果，并输出到当前光标位置。
4. When 多个快捷键同时按下时，系统 shall 优先响应最先按下的快捷键，忽略后续的快捷键。

### 需求 5 - 配置持久化

**用户故事：** 作为用户，我希望我的快捷键配置能够保存并在下次启动时自动加载。

#### 验收标准

1. When 用户添加、修改或删除快捷键配置时，系统 shall 自动保存配置到本地存储。
2. When 应用启动时，系统 shall 加载所有保存的快捷键配置并注册对应的全局快捷键。
3. When 配置文件损坏或无法读取时，系统 shall 使用默认配置并通知用户。
4. While 导入导出配置时，系统 shall 验证配置文件的格式和内容有效性。

### 需求 6 - 默认配置

**用户故事：** 作为新用户，我希望系统提供一些预设的配置示例，帮助我快速上手。

#### 验收标准

1. When 用户首次启动应用时，系统 shall 创建默认的快捷键配置（如 F2 中文输入输出、F3 中文输入英文输出）。
2. When 用户选择"恢复默认配置"时，系统 shall 提示确认并重置所有配置为默认值。
3. While 显示配置列表时，系统 shall 标记哪些是默认配置，哪些是用户自定义配置。